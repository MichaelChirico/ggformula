<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formula Interface for ggplot2 • ggformula</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Formula Interface for ggplot2">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggformula</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggformula.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ggformula-blog.html">ggformula: Another Option for Teaching Graphics in R to Beginners</a>
    </li>
    <li>
      <a href="../articles/learn-more.html">Learn More About ggformula</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../tutorials/introduction.html">Plotting with Formulas</a>
    </li>
    <li>
      <a href="../tutorials/refining.html">Refining ggformula Plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ProjectMOSAIC/ggformula">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Formula Interface for ggplot2</h1>
                        <h4 class="author">Daniel Kaplan and Randall Pruim</h4>
            
            <h4 class="date">January, 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ProjectMOSAIC/ggformula/blob/master/vignettes/ggformula.Rmd"><code>vignettes/ggformula.Rmd</code></a></small>
      <div class="hidden name"><code>ggformula.Rmd</code></div>

    </div>

    
    
<div id="formula-driven-graphics" class="section level1">
<h1 class="hasAnchor">
<a href="#formula-driven-graphics" class="anchor"></a>Formula-driven graphics</h1>
<p>There are several excellent graphics packages provided for R. The <code>ggformula</code> package currently builds on one of them, <code>ggplot2</code>, but provides a very different user interface for creating plots. The interface is based on formulas (much like the <code>lattice</code> interface) and the use of the chaining operator (<code>%&gt;%</code>) to build more complex graphics from simpler components.</p>
<p>The <code>ggformula</code> graphics were designed with several user groups in mind:</p>
<ul>
<li><p>beginners who want to get started quickly and may find the syntax of <code>ggplot2()</code> a bit offputting,</p></li>
<li><p>those familiar with <code>lattice</code> graphics, but wanting to be able to easily create multilayered plots,</p></li>
<li><p>those who prefer a formula interface, perhaps because it is familiar from use with functions like <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> or from use of the <code>mosaic</code> package for numerical summaries.</p></li>
</ul>
<div id="the-basic-formula-template" class="section level2">
<h2 class="hasAnchor">
<a href="#the-basic-formula-template" class="anchor"></a>The basic formula template</h2>
<p>The basic template for creating a plot with <code>ggformula</code> is</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">gf_plottype</span>(formula, <span class="dt">data =</span> mydata)</a></code></pre></div>
<p>where</p>
<ul>
<li><p><code>plottype</code> describes the type of plot (layer) desired (points, lines, a histogram, etc., etc.),</p></li>
<li><p><code>mydata</code> is a data frame containing the variables used in the plot, and</p></li>
<li><p><code>formula</code> describes how/where those variables are used.</p></li>
</ul>
<p>For example, in a bivariate plot, <code>formula</code> will take the form <code>y ~ x</code>, where <code>y</code> is the name of a variable to be plotted on the y-axis and <code>x</code> is the name of a variable to be plotted on the x-axis. (It is also possible to use expressions that can be evaluated using variables in the data frame as well.)</p>
<p>Here is a simple example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggformula)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp, <span class="dt">data =</span> mtcars)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/simple-example-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="selecting-the-glyph-type" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-the-glyph-type" class="anchor"></a>Selecting the glyph type</h2>
<p>The “kind of graphic” is specified by the name of the graphics function. All of the <code>ggformula</code> data graphics functions have names starting with <code>gf_</code>, which is intended to remind the user that they are formula-based interfaces to <code>ggplot2</code>: <code>g</code> for <code>ggplot2</code> and <code>f</code> for “formula.” Commonly used functions include</p>
<ul>
<li>
<code><a href="../reference/gf_point.html">gf_point()</a></code> for scatter plots</li>
<li>
<code><a href="../reference/gf_line.html">gf_line()</a></code> for line plots (connecting dots in a scatter plot)</li>
<li>
<code><a href="../reference/gf_density.html">gf_density()</a></code> or <code><a href="../reference/gf_density.html">gf_dens()</a></code> or <code><a href="../reference/gf_histogram.html">gf_histogram()</a></code> or <code><a href="../reference/gf_histogram.html">gf_dhistogram()</a></code> or <code><a href="../reference/gf_freqpoly.html">gf_freqpoly()</a></code> to display distributions of a quantitative variable</li>
<li>
<code><a href="../reference/gf_boxplot.html">gf_boxplot()</a></code> or <code><a href="../reference/gf_violin.html">gf_violin()</a></code> for comparing distributions side-by-side</li>
<li>
<code><a href="../reference/gf_bar.html">gf_counts()</a></code> for bar-graph style depictions of counts.</li>
<li>
<code><a href="../reference/gf_bar.html">gf_bar()</a></code> for more general bar-graph style graphics</li>
</ul>
<p>The function names generally match a corresponding function name from <code>ggplot2</code>, although</p>
<ul>
<li>
<code><a href="../reference/gf_bar.html">gf_counts()</a></code> is a simplified special case of <code>geom_bar()</code>,</li>
<li>
<code><a href="../reference/gf_density.html">gf_dens()</a></code> is an alternative to <code><a href="../reference/gf_density.html">gf_density()</a></code> that displays the density plot slightly differently</li>
<li>
<code><a href="../reference/gf_histogram.html">gf_dhistogram()</a></code> produces a density histogram rather than a count histogram.</li>
</ul>
<p>Each of the <code>gf_</code> functions can create the coordinate axes and fill it in one operation. (In <code>ggplot2</code> nomenclature, <code>gf_</code> functions create a frame and add a layer, all in one operation.) This is what happens for the first <code>gf_</code> function in a chain. For subsequent <code>gf_</code> functions, new layers are added, each one “on top of” the previous layers.</p>
</div>
<div id="attributes" class="section level2">
<h2 class="hasAnchor">
<a href="#attributes" class="anchor"></a>Attributes</h2>
<p>Each of the marks in the plot is a <em>glyph</em>. Every glyph has graphical <em>attributes</em> (called aesthetics in <code>ggplot2</code>) that tell where and how to draw the glyph. In the above plot, the obvious attributes are x- and y-position:<br>
We’ve told R to put <code>mpg</code> along the y-axis and <code>hp</code> along the x-asis, as is clear from the plot.</p>
<p>But each point also has other attributes, including color, shape, size, stroke, fill, and alpha (transparency). We didn’t specify those in our example, so <code><a href="../reference/gf_point.html">gf_point()</a></code> uses some default values for those – in this case smallish black filled-in circles.</p>
<div id="specifying-attributes" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-attributes" class="anchor"></a>Specifying attributes</h3>
<p>In the <code>gf_</code> functions, you specify the non-position graphical attributes using an extension of the basic formula. Attributes can be <strong>set</strong> to a constant value (e.g, set the color to “blue”; set the size to 2) or they can be <strong>mapped</strong> to a variable in the data or some expression involving the variables (e.g., map the color to <code>sex</code>, so sex determines the color groupings)</p>
<p>Attributes are set or mapped using additional arguments.</p>
<ul>
<li>adding an argument of the form <code>attribute = value</code> <strong>sets</strong> <code>attribute</code> to <code>value</code>.</li>
<li>adding an argument of the form <code>attribute = ~ expression</code> <strong>maps</strong> <code>attribute</code> to <code>expression</code>
</li>
</ul>
<p>where <code>attribute</code> is one of <code>color</code>, <code>shape</code>, etc., <code>value</code> is a constant (e.g. <code>"red"</code> or <code>0.5</code>, as appropriate), and <code>expression</code> may be some more general expression that can be computed using the variables in <code>data</code> (although often is is better to create a new variable in the data and to use that variable instead of an on-the-fly calculation within the plot).</p>
<p>The following plot, for instance,</p>
<ul>
<li><p>We use <code>cyl</code> to determine the color and <code>carb</code> to determine the size of each dot. Color and size are <strong>mapped</strong> to <code>cyl</code> and <code>carb</code>. A legend is provided to show us how the mapping is being done. (Later, we can use scales to control precisely how the mapping is done – which colors and sizes are used to represent which values of <code>cyl</code> and <code>carb</code>.)</p></li>
<li><p>We also <strong>set</strong> the transparency to 50%. The gives the same value of <code>alpha</code> to all glyphs in this layer.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>cyl, <span class="dt">size =</span> <span class="op">~</span><span class="st"> </span>carb, <span class="dt">alpha =</span> <span class="fl">0.50</span>, <span class="dt">data =</span> mtcars) </a></code></pre></div>
<p><img src="ggformula_files/figure-html/mapping-setting-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="on-the-fly-calculations" class="section level3">
<h3 class="hasAnchor">
<a href="#on-the-fly-calculations" class="anchor"></a>On-the-fly calculations</h3>
<p><code>ggformula</code> allows for on-the-fly calculations of attributes, although the default labeling of the plot is often better if we create a new variable in our data frame. In the examples below, since there are only three values for <code>carb</code>, it is easier to read the graph if we tell R to treat <code>cyl</code> as a categorical variable by converting to a factor (or to a string). Except for the labeling of the legend, these two plots are the same.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp,  <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(cyl), <span class="dt">size =</span> <span class="op">~</span><span class="st"> </span>carb, <span class="dt">alpha =</span> <span class="fl">0.75</span>, <span class="dt">data =</span> mtcars)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp,  <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>cylinders, <span class="dt">size =</span> <span class="op">~</span><span class="st"> </span>carb, <span class="dt">alpha =</span> <span class="fl">0.75</span>, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">         <span class="dt">data =</span> mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">cylinders =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(cyl)))</a></code></pre></div>
<p><img src="ggformula_files/figure-html/on-the-fly-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/on-the-fly-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="one-variable-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#one-variable-plots" class="anchor"></a>“One-variable” plots</h2>
<p>For some plots, we only have to specify the x-position because the y-position is calculated from the x-values. Histograms, densityplots, and frequency polygons are examples. To illustrate, we’ll use density plots, but the same ideas apply to <code><a href="../reference/gf_histogram.html">gf_histogram()</a></code>, and <code>gf_freqpolygon()</code> as well. <em>Note that in the one-variable density graphics, the variable whose density is to be calculated goes to the right of the tilde, in the position reserved for the x-axis variable.</em></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(Runners, <span class="dt">package =</span> <span class="st">"mosaicModel"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">Runners &lt;-<span class="st"> </span>Runners <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>( <span class="op">!</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(net))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="../reference/gf_density.html">gf_density</a></span>( <span class="op">~</span><span class="st"> </span>net, <span class="dt">data =</span> Runners)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="../reference/gf_density.html">gf_density</a></span>( <span class="op">~</span><span class="st"> </span>net,  <span class="dt">fill =</span> <span class="op">~</span><span class="st"> </span>sex,  <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">data =</span> Runners)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co"># gf_dens() is similar, but there is no line at bottom/sides, and it is not "fillable"</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw"><a href="../reference/gf_density.html">gf_dens</a></span>( <span class="op">~</span><span class="st"> </span>net, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>sex, <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">data =</span> Runners)    </a></code></pre></div>
<p><img src="ggformula_files/figure-html/Runners-1.png" width="30%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/Runners-2.png" width="30%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/Runners-3.png" width="30%" style="display: block; margin: auto;"></p>
<p>Several of the plotting functions include additional arguments that do not modify attributes of individual glyphs but control some other aspect of the plot. In this case, <code>adjust</code> can be used to increase or decrease the amount of smoothing.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># less smoothing</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="../reference/gf_density.html">gf_dens</a></span>( <span class="op">~</span><span class="st"> </span>net, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>sex, <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">data =</span> Runners, <span class="dt">adjust =</span> <span class="fl">0.25</span>)  </a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co"># more smoothing</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw"><a href="../reference/gf_density.html">gf_dens</a></span>( <span class="op">~</span><span class="st"> </span>net, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>sex, <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">data =</span> Runners, <span class="dt">adjust =</span> <span class="dv">4</span>)     </a></code></pre></div>
<p><img src="ggformula_files/figure-html/dens-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/dens-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="position" class="section level2">
<h2 class="hasAnchor">
<a href="#position" class="anchor"></a>Position</h2>
<p>When the <code>fill</code> or <code>color</code> or <code>group</code> aesthetics are mapped to a variable, the default behavior is to lay the group-wise densities on top of one another. Other behavior is also available by using <code>position</code> in the formula. Using the value <code>"stack"</code> causes the densities to be laid one on top of another, so that the overall height of the stack is the density across all groups. The value <code>"fill"</code> produces a conditional probability graphic.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/gf_density.html">gf_density</a></span>( <span class="op">~</span><span class="st"> </span>net, <span class="dt">fill =</span> <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="ot">NA</span>, <span class="dt">position =</span> <span class="st">"stack"</span>, <span class="dt">data =</span> Runners)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="../reference/gf_density.html">gf_density</a></span>( <span class="op">~</span><span class="st"> </span>net, <span class="dt">fill =</span> <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="ot">NA</span>, <span class="dt">position =</span> <span class="st">"fill"</span>, <span class="dt">data =</span> Runners, <span class="dt">adjust =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/position-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/position-2.png" width="45%" style="display: block; margin: auto;"></p>
<p>Similar commands can be constructed with <code><a href="../reference/gf_histogram.html">gf_histogram()</a></code> and <code><a href="../reference/gf_freqpoly.html">gf_freqpoly()</a></code>, but note that <code>color</code>, not <code>fill</code>, is the active attribute for frequency polygons. It’s also rarely good to overlay histograms on top of one another – better to use a density plot or a frequency polygon for that application.</p>
</div>
<div id="faceting" class="section level2">
<h2 class="hasAnchor">
<a href="#faceting" class="anchor"></a>Faceting</h2>
<p>The <code>ggplot2</code> system allows you to make subplots — called “facets” — based on the values of one or two categorical variables. This is done by chaining with <code><a href="../reference/gf_facet_grid.html">gf_facet_grid()</a></code> or <code><a href="../reference/gf_facet_grid.html">gf_facet_wrap()</a></code>. These functions use formulas to specify which variable(s) are to be used for faceting.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/gf_density_2d.html">gf_density_2d</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/gf_facet_grid.html">gf_facet_grid</a></span>( <span class="op">~</span><span class="st"> </span>sex)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># the dot here is a bit strange, but required to make a valid formula</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="../reference/gf_density_2d.html">gf_density_2d</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/gf_facet_grid.html">gf_facet_grid</a></span>( sex <span class="op">~</span><span class="st"> </span>.)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw"><a href="../reference/gf_density_2d.html">gf_density_2d</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/gf_facet_grid.html">gf_facet_wrap</a></span>( <span class="op">~</span><span class="st"> </span>year)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="kw"><a href="../reference/gf_density_2d.html">gf_density_2d</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/gf_facet_grid.html">gf_facet_grid</a></span>(start_position <span class="op">~</span><span class="st"> </span>sex)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/facets-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/facets-2.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/facets-3.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/facets-4.png" width="45%" style="display: block; margin: auto;"></p>
<p>An alternative syntax uses <code>|</code> to separate the faceting information from the main part of the formula.<br>
Here is another example using our weather data. The redundant use of the <code>y</code> and <code>color</code> attributes for temperature makes it easier to compare across facets.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/gf_ribbon.html">gf_ribbon</a></span>(low_temp <span class="op">+</span><span class="st"> </span>high_temp <span class="op">~</span><span class="st"> </span>date <span class="op">|</span><span class="st"> </span>city <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> Weather, <span class="dt">alpha =</span> <span class="fl">0.3</span>) </a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw"><a href="../reference/gf_linerange.html">gf_linerange</a></span>(low_temp <span class="op">+</span><span class="st"> </span>high_temp <span class="op">~</span><span class="st"> </span>date <span class="op">|</span><span class="st"> </span>city <span class="op">~</span><span class="st"> </span>year, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>avg_temp, <span class="dt">data =</span> Weather) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(<span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="dv">5</span>))))</a></code></pre></div>
<p><img src="ggformula_files/figure-html/facets02-1.png" width="95%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/facets02-2.png" width="95%" style="display: block; margin: auto;"></p>
<p>In this case, we should either not facet by year, or allows the x-scale to be freely adjusted in each column so that we don’t have so much unnecessary white space. We can do the latter using the <code>scales</code> argument to <code><a href="../reference/gf_facet_grid.html">gf_facet_grid()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../reference/gf_ribbon.html">gf_ribbon</a></span>(low_temp <span class="op">+</span><span class="st"> </span>high_temp <span class="op">~</span><span class="st"> </span>date <span class="op">|</span><span class="st"> </span>city <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Weather, <span class="dt">alpha =</span> <span class="fl">0.3</span>) </a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="../reference/gf_linerange.html">gf_linerange</a></span>(low_temp <span class="op">+</span><span class="st"> </span>high_temp <span class="op">~</span><span class="st"> </span>date, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>avg_temp, <span class="dt">data =</span> Weather) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(<span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="dv">5</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/gf_facet_grid.html">gf_facet_grid</a></span>(city <span class="op">~</span><span class="st"> </span>year, <span class="dt">scales =</span> <span class="st">"free_x"</span>)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/facets03-1.png" width="95%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/facets03-2.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div id="more-2-variable-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#more-2-variable-plots" class="anchor"></a>More 2-variable plots</h2>
<div id="using-jitter-and-transparency-to-handle-overlapping-cases" class="section level3">
<h3 class="hasAnchor">
<a href="#using-jitter-and-transparency-to-handle-overlapping-cases" class="anchor"></a>Using jitter and transparency to handle overlapping cases</h3>
<p>Sometimes you have so many points in a scatter plot that they obscure one another. The <code>ggplot2</code> system provides two easy ways to deal with this: translucency and jittering.</p>
<p>Use <code>alpha = 0.5</code> to make the points semi-translucent. If there are many points overlapping at one point, a much smaller value of alpha, say <code>alpha = 0.01</code>. We’ve already seen this above.</p>
<p>Using <code><a href="../reference/gf_jitter.html">gf_jitter()</a></code> in place of <code><a href="../reference/gf_point.html">gf_point()</a></code> will move the plotted points to reduce overlap. Jitter and transparency can be used together as well.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(age <span class="op">~</span><span class="st"> </span>sex, <span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">data =</span> Runners)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="../reference/gf_jitter.html">gf_jitter</a></span>(age <span class="op">~</span><span class="st"> </span>sex, <span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">data =</span> Runners)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/jitter-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/jitter-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="box-and-whisker-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#box-and-whisker-plots" class="anchor"></a>Box and Whisker plots</h3>
<p>Box and whisker plots show the distribution of a quantitative variable as a function of a categorical variable. The formula used in <code><a href="../reference/gf_boxplot.html">gf_boxplot()</a></code> should have the quantitative variable to the left of the tilde. (To make horizontal boxplots using <code>ggplot2</code> you have to make vertical boxplots and then flip the coordinates with <code>coord_flip()</code>.)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../reference/gf_boxplot.html">gf_boxplot</a></span>(net <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">data =</span> Runners)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="../reference/gf_boxplot.html">gf_boxplot</a></span>(net <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>start_position, <span class="dt">data =</span> Runners)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/boxplot-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/boxplot-2.png" width="45%" style="display: block; margin: auto;"></p>
<p>This plot may surprise you.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="../reference/gf_boxplot.html">gf_boxplot</a></span>(net <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> Runners)</a></code></pre></div>
<pre><code>## Warning: Continuous x aesthetic -- did you forget aes(group=...)?</code></pre>
<p><img src="ggformula_files/figure-html/boxplot02-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>This plot is placing a single box and whisker plot at the mean value of <code>year</code>. The warning message suggests that we need to tell R how to form the groups when using a quantitative variable for <code>x</code>. It suggests using the <code>group</code> aesthetic, and sometimes, this is just what we want.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/gf_boxplot.html">gf_boxplot</a></span>(net <span class="op">~</span><span class="st"> </span>year, <span class="dt">group =</span> <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> Runners)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/boxplot03-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>But often, is is better to convert a discrete quantitative variable used for grouping into a categorical variable (a factor or character vector). This can be done in several ways:</p>
<p><img src="ggformula_files/figure-html/factors-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="dimensional-density-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#dimensional-density-plots" class="anchor"></a>2-dimensional density plots</h3>
<p>Two-dimensional plots of density also have both a left and right component to the formula.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="../reference/gf_density_2d.html">gf_density_2d</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="../reference/gf_hex.html">gf_hex</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/density2d-hex-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/density2d-hex-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="paths-and-lines" class="section level3">
<h3 class="hasAnchor">
<a href="#paths-and-lines" class="anchor"></a>Paths and lines</h3>
<p>The <code>ggplot2</code> system offers two ways to connect points. <code><a href="../reference/gf_line.html">gf_line()</a></code> ignores the order of the points in the data, and draws the line going from left to right. <code><a href="../reference/gf_line.html">gf_path()</a></code> goes from point to point according to the order in the data. Both forms can use a <code>color</code> or <code>group</code> aesthetic to indicate which groups of points are connected.</p>
<!-- The above are examples of *bad plots*. The viewer is unnecessarily distracted by -->
<!-- the zigs and zags in the connecting lines. It would be better to use -->
<!-- `gf_point()` here, but then you wouldn't see how `gf_line()` and `gf_path()` -->
<!-- work! -->
<p>Here’s an example where <code><a href="../reference/gf_line.html">gf_line()</a></code> is useful. We begin with a scatter plot showing the number of live births in the US for each day of 1978.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mosaicData)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(births <span class="op">~</span><span class="st"> </span>date, <span class="dt">data =</span> Births78)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/births01-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>Can this interesting pattern be explained by a weekday/weekend effect?<br>
Converting to a line plot and coloring by day of week highlights the pattern and makes it easy to spot the unusual days.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/gf_line.html">gf_line</a></span>(births <span class="op">~</span><span class="st"> </span>date, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>wday, <span class="dt">data =</span> Births78)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/births03-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>The example above would look the same if we used <code><a href="../reference/gf_line.html">gf_path()</a></code> because the data set is already sorted by date. But in general, <code><a href="../reference/gf_line.html">gf_path()</a></code> and <code><a href="../reference/gf_line.html">gf_line()</a></code> produce different results. In the plots below, the first connects days chronologically (because the data are sorted by date) and the second in order of their low temperature.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">Weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">5</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>, city <span class="op">==</span><span class="st"> "Chicago"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_line.html">gf_path</a></span>(high_temp <span class="op">~</span><span class="st"> </span>low_temp <span class="op">|</span><span class="st"> </span>city <span class="op">~</span><span class="st"> </span>year, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(<span class="kw">scale_color_viridis_c</span>(<span class="dt">option =</span> <span class="st">"C"</span>, <span class="dt">begin =</span> <span class="fl">0.2</span>, <span class="dt">end =</span> <span class="fl">0.8</span>))</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">Weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">5</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>, city <span class="op">==</span><span class="st"> "Chicago"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/gf_line.html">gf_line</a></span>(high_temp <span class="op">~</span><span class="st"> </span>low_temp <span class="op">|</span><span class="st"> </span>city <span class="op">~</span><span class="st"> </span>year, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(<span class="kw">scale_color_viridis_c</span>(<span class="dt">option =</span> <span class="st">"C"</span>, <span class="dt">begin =</span> <span class="fl">0.2</span>, <span class="dt">end =</span> <span class="fl">0.8</span>))</a></code></pre></div>
<p><img src="ggformula_files/figure-html/paths-1.png" width="30%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/paths-2.png" width="30%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="plots-with-more-than-2-positional-attributes" class="section level2">
<h2 class="hasAnchor">
<a href="#plots-with-more-than-2-positional-attributes" class="anchor"></a>Plots with more than 2 positional attributes</h2>
<p>Some layers require more than two attributes. Typically this happens when the glyphs of a layer are complex objects that could have been made using multiple layers, but belong together conceptually. Examples include</p>
<ul>
<li>
<code><a href="../reference/gf_linerange.html">gf_pointrange()</a></code> – plots a dot flanked by a line segment.<br>
</li>
<li>
<code>gf_linrange()</code> – like <code><a href="../reference/gf_linerange.html">gf_pointrange()</a></code> but without the point.</li>
<li>
<code><a href="../reference/gf_errorbar.html">gf_errorbar()</a></code> – vertical error bars.</li>
<li>
<code><a href="../reference/gf_errorbarh.html">gf_errorbarh()</a></code> – horizontal error bars.</li>
<li>
<code><a href="../reference/gf_ribbon.html">gf_ribbon()</a></code> – a band between a line above and line below.</li>
</ul>
<p>Often these are used to depict some sort of estimate of uncertainty in a measurement or a prediction, but they can be used to represent any data of the correct form. Here we will use <code><a href="../reference/gf_linerange.html">gf_linerange()</a></code> and <code><a href="../reference/gf_ribbon.html">gf_ribbon()</a></code> to indicate the high and low temperatures in New York for the first few months of 2013.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">Temps &lt;-</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span>Weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>, year <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2016</span>, city <span class="op">==</span><span class="st"> "Chicago"</span>)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="kw"><a href="../reference/gf_linerange.html">gf_pointrange</a></span>(avg_temp <span class="op">+</span><span class="st"> </span>low_temp <span class="op">+</span><span class="st"> </span>high_temp  <span class="op">~</span><span class="st"> </span>date, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>avg_temp, <span class="dt">data =</span> Temps) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(<span class="kw">scale_color_gradientn</span>(<span class="dt">colors =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>)))</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="kw"><a href="../reference/gf_ribbon.html">gf_ribbon</a></span>(low_temp <span class="op">+</span><span class="st"> </span>high_temp  <span class="op">~</span><span class="st"> </span>date, <span class="dt">color =</span> <span class="st">"navy"</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">data =</span> Temps)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/weather-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/weather-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="positions-and-stats" class="section level2">
<h2 class="hasAnchor">
<a href="#positions-and-stats" class="anchor"></a>Positions and Stats</h2>
<div id="positions" class="section level3">
<h3 class="hasAnchor">
<a href="#positions" class="anchor"></a>Positions</h3>
<p><code>position_dodge()</code>, <code>position_jitter()</code>, and <code>position_jitterdodge()</code> can be used to adjust the positions at which glyphs are placed. Jittering adds some random noise and can be useful when many observations have the same value. Dodging moves groups of glyphs a fixed difference to make it easier to distinguish the groups.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(length <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet,</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">         <span class="dt">position =</span> <span class="kw">position_jitterdodge</span>(<span class="dt">jitter.width =</span> <span class="fl">0.2</span>, <span class="dt">dodge.width =</span> <span class="fl">0.4</span>))</a></code></pre></div>
<p><img src="ggformula_files/figure-html/KidsFeet-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="stats" class="section level3">
<h3 class="hasAnchor">
<a href="#stats" class="anchor"></a>Stats</h3>
<p>A <strong>stat</strong> is a transformation that is applied to the data before a plot is generated. Several of the plots we have seen have made use of stats.</p>
<ul>
<li>
<code><a href="../reference/gf_histogram.html">gf_histogram()</a></code> uses <code>stat_bin()</code> to bin the data and count the number of observations in each bin. It is equivalent to</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../reference/gf_bar.html">gf_bar</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> HELPrct, <span class="dt">stat =</span> <span class="st">"bin"</span>)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="ggformula_files/figure-html/stats-1.png" width="45%" style="display: block; margin: auto;"></p>
<ul>
<li><p><code><a href="../reference/gf_boxplot.html">gf_boxplot()</a></code> uses <code>stat_boxplot()</code> to compute the five-number summary on which the boxplot is based.</p></li>
<li><p><code><a href="../reference/gf_violin.html">gf_violin()</a></code>, <code><a href="../reference/gf_density.html">gf_density()</a></code>, and <code><a href="../reference/gf_density_2d.html">gf_density2d()</a></code> use stats to compute a sequence of points along an estimated density. It is these points, and the not the raw data that are used to create the plot.</p></li>
</ul>
<p>There are also a number of stats that can be used to show a functional relationship between two variables.</p>
<ul>
<li><p><code><a href="../reference/gf_smooth.html">gf_smooth()</a></code> plots a model fit using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>, <code>gam()</code>, <code><a href="https://rdrr.io/r/stats/loess.html">loess()</a></code>, <code><a href="https://rdrr.io/pkg/MASS/man/rlm.html">MASS::rlm()</a></code>.</p></li>
<li><p><code><a href="../reference/gf_smooth.html">gf_lm()</a></code> is <code><a href="../reference/gf_smooth.html">gf_smooth()</a></code> with the method set to <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> so it plots a least squares regression line.</p></li>
<li><p><code><a href="../reference/gf_spline.html">gf_spline()</a></code> plots a spline fit to the data.</p></li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(length <span class="op">~</span><span class="st"> </span>width, <span class="dt">data =</span> KidsFeet, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/gf_smooth.html">gf_lm</a></span>()</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(births <span class="op">~</span><span class="st"> </span>date, <span class="dt">color =</span> <span class="op">~</span>wday,</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">         <span class="dt">data =</span> mosaicData<span class="op">::</span>Births, <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/gf_smooth.html">gf_smooth</a></span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
<p><img src="ggformula_files/figure-html/unnamed-chunk-2-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-2-2.png" width="45%" style="display: block; margin: auto;"></p>
<p>Confidence or prediction bands can be added to these as well.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(length <span class="op">~</span><span class="st"> </span>width <span class="op">|</span><span class="st"> </span>sex, <span class="dt">data =</span> KidsFeet, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/gf_smooth.html">gf_lm</a></span>(<span class="dt">interval =</span> <span class="st">"prediction"</span>, <span class="dt">fill =</span> <span class="st">"red"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_smooth.html">gf_lm</a></span>(<span class="dt">interval =</span> <span class="st">"confidence"</span>, <span class="dt">fill =</span> <span class="st">"navy"</span>)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/unnamed-chunk-3-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>Mostly, the stats selected by default are just the ones you need. But sometimes it is useful to select a different stat. The <code>stat_summary()</code> and <code>stat_summary_bin()</code> stats are particularly useful in this respect. These stats use a function to aggregate over unique values of <code>x</code> or over bins of <code>x</code> values and save the user needing to do that data transformation manually.</p>
<p>The default function applied in each group is <code>mean_se()</code>, which computes the mean (and the mean plus and minus one standard error) This makes it simple to create an “interaction plot”.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="../reference/gf_jitter.html">gf_jitter</a></span>(length <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet,</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">          <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">height =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_line.html">gf_line</a></span>(length <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet,</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">          <span class="dt">group =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">stat=</span><span class="st">"summary"</span>)</a></code></pre></div>
<pre><code>## No summary function supplied, defaulting to `mean_se()</code></pre>
<p><img src="ggformula_files/figure-html/stats02-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>The other two values computed by <code>mean_se()</code> are available (starting with <code>ggplot2</code> version 2.3) as <code>stat(ymin)</code> and <code>stat(ymax)</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="../reference/gf_jitter.html">gf_jitter</a></span>(length <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet,</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">          <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">height =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_linerange.html">gf_pointrange</a></span>(length <span class="op">+</span><span class="st"> </span><span class="kw">stat</span>(ymin) <span class="op">+</span><span class="st"> </span><span class="kw">stat</span>(ymax) <span class="op">~</span><span class="st"> </span>sex, </a>
<a class="sourceLine" id="cb29-4" data-line-number="4">                <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet, </a>
<a class="sourceLine" id="cb29-5" data-line-number="5">                <span class="dt">group =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">stat=</span><span class="st">"summary"</span>)</a></code></pre></div>
<pre><code>## No summary function supplied, defaulting to `mean_se()</code></pre>
<p><img src="ggformula_files/figure-html/stats03-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>Custom functions can be used by defining <code>fun.y</code>, <code>fun.ymin</code>, and <code>fun.ymax</code>, or a single function <code>fun.data</code> that returns a data frame with variables named <code>y</code>, <code>ymin</code>, and <code>ymax</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(length <span class="op">~</span><span class="st"> </span>sex, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet,</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">          <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">height =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">          <span class="dt">position =</span> <span class="kw">position_jitterdodge</span>(<span class="dt">jitter.width =</span> <span class="fl">0.2</span>, <span class="dt">dodge.width =</span> <span class="fl">0.3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_linerange.html">gf_pointrange</a></span>(length <span class="op">+</span><span class="st"> </span><span class="kw">stat</span>(ymin) <span class="op">+</span><span class="st"> </span><span class="kw">stat</span>(ymax) <span class="op">~</span><span class="st"> </span>sex, </a>
<a class="sourceLine" id="cb31-5" data-line-number="5">                <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">data =</span> KidsFeet, </a>
<a class="sourceLine" id="cb31-6" data-line-number="6">                <span class="dt">group =</span> <span class="op">~</span><span class="st"> </span>domhand, <span class="dt">stat=</span><span class="st">"summary"</span>,</a>
<a class="sourceLine" id="cb31-7" data-line-number="7">                <span class="dt">fun.y =</span> median, <span class="dt">fun.ymin =</span> min, <span class="dt">fun.ymax =</span> max,</a>
<a class="sourceLine" id="cb31-8" data-line-number="8">                <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.6</span>))</a></code></pre></div>
<p><img src="ggformula_files/figure-html/stats04-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-functions" class="anchor"></a>Plotting functions</h3>
<p><code>ggformula</code> provides two way to plot functions: <code><a href="../reference/gf_function.html">gf_function()</a></code> and <code><a href="../reference/gf_function.html">gf_fun()</a></code>. They differ primarily in how one specifies the function to be plotted.</p>
<ul>
<li>
<code><a href="../reference/gf_function.html">gf_function()</a></code> requires a (vectorized) function of one variable.</li>
<li>
<code><a href="../reference/gf_function.html">gf_fun()</a></code> requires a formula describing how the y-values are computed from the x-values.</li>
</ul>
<p>If these are used as a first layer, the limits for the x-axis must be specified.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="../reference/gf_function.html">gf_function</a></span>(<span class="dt">fun =</span> sqrt, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/gf_function.html">gf_fun</a></span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>x) <span class="op">~</span><span class="st"> </span>x, <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">n =</span> <span class="dv">800</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/mosaicCore/man/makeFun.html">makeFun</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(totalbill <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(month, <span class="dv">2</span>), <span class="dt">data =</span> mosaicData<span class="op">::</span>Utilities))</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(totalbill <span class="op">~</span><span class="st"> </span>month, <span class="dt">data =</span> mosaicData<span class="op">::</span>Utilities, <span class="dt">alpha =</span> <span class="fl">0.6</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/gf_function.html">gf_fun</a></span>(<span class="kw">f</span>(m) <span class="op">~</span><span class="st"> </span>m, <span class="dt">color =</span> <span class="st">"red"</span>)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/functions-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/functions-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="chaining-to-create-complex-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#chaining-to-create-complex-plots" class="anchor"></a>Chaining to create complex plots</h2>
<div id="multiple-layers" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-layers" class="anchor"></a>Multiple layers</h3>
<p>Often it is useful to overlay multiple layers onto a single plot. This can be done by chaining them with <code>%&gt;%</code>, the “then” operator from <code>magrittr</code>. The <code>data</code> argument can be omitted if the new layers uses the same data as the first layer in the chain.</p>
<p>The following plot illustrates how histograms and frequency polygons are related.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw"><a href="../reference/gf_histogram.html">gf_histogram</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">fill =</span> <span class="st">"navy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/gf_freqpoly.html">gf_freqpoly</a></span>( <span class="op">~</span><span class="st"> </span>age)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="ggformula_files/figure-html/layers-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>A 2-d density plot can be augmented with a scatterplot.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="../reference/gf_density_2d.html">gf_density_2d</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/gf_point.html">gf_point</a></span>(net <span class="op">~</span><span class="st"> </span>age, <span class="dt">alpha =</span> <span class="fl">0.01</span>) </a></code></pre></div>
<p><img src="ggformula_files/figure-html/layers02-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="maps" class="section level3">
<h3 class="hasAnchor">
<a href="#maps" class="anchor"></a>Maps</h3>
<p>Prior to <code>ggplot2</code> version 2.3, basic maps could be created using <code><a href="../reference/gf_polygon.html">gf_polygon()</a></code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(maps) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(dplyr)) {</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">  US &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">"state"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">name_length =</span> <span class="kw"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span>(region))</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  States &lt;-<span class="st"> </span>US <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">lat =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(lat)), <span class="dt">long =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(long))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/abbreviate.html">abbreviate</a></span>(region, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb36-8" data-line-number="8"></a>
<a class="sourceLine" id="cb36-9" data-line-number="9">  <span class="kw"><a href="../reference/gf_polygon.html">gf_polygon</a></span>(lat <span class="op">~</span><span class="st"> </span>long, <span class="dt">data =</span> US, <span class="dt">group =</span> <span class="op">~</span><span class="st"> </span>group,</a>
<a class="sourceLine" id="cb36-10" data-line-number="10">             <span class="dt">fill =</span> <span class="op">~</span><span class="st"> </span>name_length, <span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/gf_text.html">gf_text</a></span>(lat <span class="op">~</span><span class="st"> </span>long, <span class="dt">label =</span> <span class="op">~</span><span class="st"> </span>name, <span class="dt">data =</span> States,</a>
<a class="sourceLine" id="cb36-12" data-line-number="12">    <span class="dt">color =</span> <span class="st">"gray70"</span>, <span class="dt">inherit =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(mosaic<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/mosaic/man/theme_map.html">theme_map</a></span>())</a>
<a class="sourceLine" id="cb36-14" data-line-number="14">}</a></code></pre></div>
<p><img src="ggformula_files/figure-html/unnamed-chunk-4-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Starting with <code>ggplot2</code> version 2.3, there is direct support for shape files. This allows each row of a data frame to contain all the geometry information for a region in a single column. There is also better support for overlaying information from multiple shape files.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(maps) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(dplyr) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(sf) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(purrr)) {</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">  USshape &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">    </span>sf<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(maps<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">'state'</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">      <span class="dt">name_length =</span> <span class="kw"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span>(ID),</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">      <span class="dt">centroid =</span> purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(geometry, st_centroid),</a>
<a class="sourceLine" id="cb37-7" data-line-number="7">      <span class="dt">coords_x =</span> purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(centroid, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb37-8" data-line-number="8">      <span class="dt">coords_y =</span> purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(centroid, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb37-9" data-line-number="9">    ) </a>
<a class="sourceLine" id="cb37-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb37-11" data-line-number="11">  <span class="kw"><a href="../reference/gf_sf.html">gf_sf</a></span>(<span class="dt">fill =</span> <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(name_length), <span class="dt">color =</span> <span class="st">"white"</span>, <span class="dt">data =</span> USshape, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-12" data-line-number="12"><span class="st">    </span><span class="kw"><a href="../reference/gf_sf.html">gf_sf</a></span>(<span class="dt">data =</span> sf<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_unary.html">st_centroid</a></span>(USshape), <span class="dt">color =</span> <span class="st">"white"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-13" data-line-number="13"><span class="st">    </span><span class="kw"><a href="../reference/gf_text.html">gf_text</a></span>(coords_y <span class="op">~</span><span class="st"> </span>coords_x, <span class="dt">label =</span> <span class="op">~</span><span class="st"> </span>ID, <span class="dt">color =</span> <span class="st">"gray20"</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-14" data-line-number="14"><span class="st">    </span><span class="kw"><a href="../reference/gf_aux.html">gf_labs</a></span>(<span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">""</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="../reference/gf_aux.html">gf_refine</a></span>(mosaic<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/mosaic/man/theme_map.html">theme_map</a></span>(), <span class="kw">theme_bw</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-16" data-line-number="16"><span class="st">    </span><span class="kw"><a href="../reference/gf_aux.html">gf_labs</a></span>(<span class="dt">fill =</span> <span class="st">"name length"</span>)</a>
<a class="sourceLine" id="cb37-17" data-line-number="17">}</a></code></pre></div>
<pre><code>## Loading required package: sf</code></pre>
<pre><code>## Linking to GEOS 3.6.1, GDAL 2.1.3, PROJ 4.9.3</code></pre>
<pre><code>## Loading required package: purrr</code></pre>
<pre><code>## 
## Attaching package: 'purrr'</code></pre>
<pre><code>## The following object is masked from 'package:maps':
## 
##     map</code></pre>
<pre><code>## Warning in st_centroid.sf(USshape): st_centroid assumes attributes are
## constant over geometries of x</code></pre>
<pre><code>## Warning in st_centroid.sfc(st_geometry(x), of_largest_polygon =
## of_largest_polygon): st_centroid does not give correct centroids for
## longitude/latitude data</code></pre>
<p><img src="ggformula_files/figure-html/unnamed-chunk-5-1.png" width="75%" style="display: block; margin: auto;"></p>
</div>
<div id="new-types-of-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#new-types-of-plots" class="anchor"></a>New types of plots</h3>
<p><code>ggformula</code> adds some additional plot options to <code>ggplot2</code></p>
<div id="ash-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#ash-plots" class="anchor"></a>ASH plots</h4>
<p>Average shifted histograms can be created with <code><a href="../reference/gf_ash.html">gf_ash()</a></code>. These plots average the height over all histograms with the same bin width. ASH plots often work well with larger bin widths than you might use for an individual histogram.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw"><a href="../reference/gf_ash.html">gf_ash</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> HELPrct, <span class="dt">binwidth =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/gf_histogram.html">gf_dhistogram</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> HELPrct, <span class="dt">binwidth =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) </a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="kw"><a href="../reference/gf_ash.html">gf_ash</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> HELPrct, <span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_histogram.html">gf_dhistogram</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> HELPrct, <span class="dt">binwidth =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) </a></code></pre></div>
<p><img src="ggformula_files/figure-html/unnamed-chunk-6-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-6-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="distribution-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#distribution-plots" class="anchor"></a>Distribution plots</h4>
<p><code><a href="../reference/gf_dist.html">gf_dist()</a></code> can be used to create plots of discrete and continuous distributions.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"pois"</span>, <span class="dt">lambda =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"pois"</span>, <span class="dt">lambda =</span> <span class="dv">5</span>, <span class="dt">kind =</span> <span class="st">"cdf"</span>)</a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"gamma"</span>, <span class="dt">shape =</span> <span class="dv">3</span>, <span class="dt">rate =</span> <span class="dv">4</span>, <span class="dt">geom =</span> <span class="st">"area"</span>)</a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"gamma"</span>, <span class="dt">shape =</span> <span class="dv">3</span>, <span class="dt">rate =</span> <span class="dv">4</span>, <span class="dt">geom =</span> <span class="st">"area"</span>, <span class="dt">fill =</span> <span class="op">~</span><span class="st"> </span>(x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"gamma"</span>, <span class="dt">shape =</span> <span class="dv">3</span>, <span class="dt">rate =</span> <span class="dv">4</span>, <span class="dt">kind =</span> <span class="st">"cdf"</span>)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/unnamed-chunk-7-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-7-2.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-7-3.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-7-4.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-7-5.png" width="45%" style="display: block; margin: auto;"></p>
<p>When distribution parameters and plot attributes have the same name, there are two ways to avoid the name colision:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="co"># size is used by the binomial distribution functions and when plotting</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"binom"</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.25</span>, <span class="dt">plot_size =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="kw"><a href="../reference/gf_dist.html">gf_dist</a></span>(<span class="st">"binom"</span>, <span class="dt">params =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.25</span>), <span class="dt">size =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="ggformula_files/figure-html/unnamed-chunk-8-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/unnamed-chunk-8-2.png" width="45%" style="display: block; margin: auto;"></p>
<p><code>ggformula</code> also provides an interface to <code><a href="https://rdrr.io/pkg/MASS/man/fitdistr.html">MASS::fitdistr()</a></code> for fitting distributions to data and displaying the resulting pdf.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span>(<span class="dv">1000</span>, <span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">rate =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="kw"><a href="../reference/gf_histogram.html">gf_dhistogram</a></span>( <span class="op">~</span><span class="st"> </span>x, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_fitdistr.html">gf_fitdistr</a></span>(<span class="dt">dist =</span> <span class="st">"dnorm"</span>, <span class="dt">color =</span> <span class="op">~</span><span class="st"> "Normal"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_fitdistr.html">gf_fitdistr</a></span>(<span class="dt">dist =</span> <span class="st">"dgamma"</span>, <span class="dt">color =</span> <span class="op">~</span><span class="st"> "Gamma"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/gf_fitdistr.html">gf_fitdistr</a></span>(<span class="dt">dist =</span> <span class="st">"dweibull"</span>, <span class="dt">color =</span> <span class="op">~</span><span class="st"> "Weibull"</span>)</a></code></pre></div>
<pre><code>## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced

## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced

## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced

## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced

## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced

## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced</code></pre>
<p><img src="ggformula_files/figure-html/unnamed-chunk-9-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="global-plot-adjustments" class="section level3">
<h3 class="hasAnchor">
<a href="#global-plot-adjustments" class="anchor"></a>Global plot adjustments</h3>
<p>There are a number of things we may want to do to the entire plot – adjusting labels, colors, fonts, etc. <code>ggformula</code> provides wrappers to the <code>ggplot2</code> functions for this so that the chaining syntax can be used.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw"><a href="../reference/gf_histogram.html">gf_histogram</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners, <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">fill =</span> <span class="st">"navy"</span>,</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">              <span class="dt">binwidth =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_freqpoly.html">gf_freqpoly</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">binwidth =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_labs</a></span>(<span class="dt">x =</span> <span class="st">"age (years)"</span>, <span class="dt">title =</span> <span class="st">"Age of runners"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_lims</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">20</span>, <span class="dv">80</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/gf_theme.html">gf_theme</a></span>(<span class="dt">theme =</span> <span class="kw">theme_minimal</span>())</a></code></pre></div>
<pre><code>## Warning: Removed 84 rows containing non-finite values (stat_bin).

## Warning: Removed 84 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw"><a href="../reference/gf_histogram.html">gf_histogram</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">fill =</span> <span class="st">"white"</span>,</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">              <span class="dt">binwidth =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gf_freqpoly.html">gf_freqpoly</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">color =</span> <span class="st">"skyblue"</span>, <span class="dt">binwidth =</span> <span class="dv">5</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_labs</a></span>(<span class="dt">x =</span> <span class="st">"age (years)"</span>, <span class="dt">title =</span> <span class="st">"Age of runners"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/gf_aux.html">gf_lims</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">20</span>, <span class="dv">80</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/gf_theme.html">gf_theme</a></span>(<span class="dt">theme =</span> <span class="kw">theme_dark</span>())</a></code></pre></div>
<pre><code>## Warning: Removed 84 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 84 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
<p><img src="ggformula_files/figure-html/themes-1.png" width="45%" style="display: block; margin: auto;"><img src="ggformula_files/figure-html/themes-2.png" width="45%" style="display: block; margin: auto;"></p>
<p>For convenience, a few modifications can also be made directly in the original function call:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw"><a href="../reference/gf_histogram.html">gf_histogram</a></span>( <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Runners, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">fill =</span> <span class="st">"skyblue"</span>, <span class="dt">color =</span> <span class="st">"navy"</span>,</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">              <span class="dt">binwidth =</span> <span class="dv">5</span>, </a>
<a class="sourceLine" id="cb57-3" data-line-number="3">              <span class="dt">xlab =</span> <span class="st">"age (years)"</span>, <span class="dt">title =</span> <span class="st">"Age of runners"</span></a>
<a class="sourceLine" id="cb57-4" data-line-number="4">              ) </a></code></pre></div>
<p><img src="ggformula_files/figure-html/unnamed-chunk-10-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#formula-driven-graphics">Formula-driven graphics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-basic-formula-template">The basic formula template</a></li>
      <li><a href="#selecting-the-glyph-type">Selecting the glyph type</a></li>
      <li><a href="#attributes">Attributes</a></li>
      <li><a href="#one-variable-plots">“One-variable” plots</a></li>
      <li><a href="#position">Position</a></li>
      <li><a href="#faceting">Faceting</a></li>
      <li><a href="#more-2-variable-plots">More 2-variable plots</a></li>
      <li><a href="#plots-with-more-than-2-positional-attributes">Plots with more than 2 positional attributes</a></li>
      <li><a href="#positions-and-stats">Positions and Stats</a></li>
      <li><a href="#chaining-to-create-complex-plots">Chaining to create complex plots</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Kaplan, Randall Pruim.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
